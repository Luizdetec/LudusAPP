<div class="report-page">
  <header class="report-top">
    <div class="report-controls">
      <app-select label="Selecione a Turma" [options]="turmas" [selected]="turmaSelecionada" (selectedChange)="onTurmaChange($event)"></app-select>
      <app-select label="Selecione o ano" [options]="ano" [selected]="anoSelecionado" (selectedChange)="onAnoChange($event)"></app-select>
      <app-button text="Atualizar" color="#111" textcolor="#FEFBF0" hoverColor="#444" (buttonClick)="buscarRelatorio()"></app-button>
    </div>

    <div class="report-actions">
      <app-button text="Cancelar" class="btn-cancel" color="#fff" textcolor="#111" hoverColor="#f1f1f1" (buttonClick)="cancel()"></app-button>
      <app-button text="Exportar" color="#111" textcolor="#FEFBF0" hoverColor="#444" (buttonClick)="exportarCSV()"></app-button>
    </div>
  </header>

  <h1 class="report-title">RELATÓRIO DE CLASSE</h1>

  <div class="table-wrap">
    <table class="report-table">
      <thead>
        <tr>
          <th class="index-col"></th>
          <th>Nome do Aluno</th>
          <th>Turma</th>
          <th>Matrícula</th>
          <th>Jan</th><th>Fev</th><th>Mar</th><th>Abr</th><th>Mai</th><th>Jun</th>
          <th>Jul</th><th>Ago</th><th>Set</th><th>Out</th><th>Nov</th><th>Dez</th>
          <th>Porcentagem de presença</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let aluno of report; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ aluno.nome_aluno }}</td>
          <td>{{ turmaExibida }}</td>
          <td>{{ aluno.matricula }}</td>
          <td>{{ aluno.jan }}</td>
          <td>{{ aluno.fev }}</td>
          <td>{{ aluno.mar }}</td>
          <td>{{ aluno.abr }}</td>
          <td>{{ aluno.mai }}</td>
          <td>{{ aluno.jun }}</td>
          <td>{{ aluno.jul }}</td>
          <td>{{ aluno.ago }}</td>
          <td>{{ aluno.set }}</td>
          <td>{{ aluno.out }}</td>
          <td>{{ aluno.nov }}</td>
          <td>{{ aluno.dez }}</td>
          <td>{{ aluno.percentual_presenca | number:'1.0-2' }}%</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

 <!-- Loading modal -->
  @if (isLoading) {
    <div class="loading-modal">
      <div class="spinner"></div>
    </div>
  }

<!-- modal -->
<div class="export-modal" *ngIf="showModal">
  <div class="export-modal__backdrop" (click)="closeModal()"></div>
  <div class="export-modal__card" role="dialog" aria-modal="true">
    <h3>Relatório exportado com sucesso!</h3>
    <br>
    <div class="modal-actions">
      <app-button text="Fechar" (click)="closeModal()" hoverColor="#f1f1f1"></app-button>
    </div>
  </div>
</div>
